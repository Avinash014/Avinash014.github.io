<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <script
      data-ad-client="ca-pub-5354363019686630"
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
    ></script>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-CCPVGMHLTY"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-CCPVGMHLTY");
    </script> -->
    <title>Test</title>
    <style>
      * {
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        list-style-position: inside;
      }

      html {
        height: 100vh;
        width: 100vw;
        overflow: auto;
        font-size: 16px;
      }
      body {
        height: 100%;
        display: flex;
        flex-direction: column;
        text-align: center;
      }
      main {
        height: 100%;
        height: -webkit-calc(100% - 60px);
        height: -moz-calc(100% - 60px);
        height: calc(100% - 60px);
        background-color: white;
      }
      header {
        height: 20%;
        max-height: 60px;
        background-color: lightgray;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      footer {
        height: 75px;
        background-color: grey;
        color: white;
        display: flex;
        font-size: 1.5rem;
        justify-content: center;
        align-items: center;
      }
      img {
        object-fit: contain;
        width: 100%;
        height: 100%;
      }

      #container {
        max-height: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      #info {
        height: 100px;
        max-height: 25%;
      }
      #instruction {
        position: absolute;
        max-width: 60%;
        text-align: left;
        border: 1px solid black;
        padding: 10px;
        top: 0;
        left: 0;
      }
      #keyRed {
        background-color: red;
      }
      #keyBlue {
        background-color: blue;
      }
      #keyGreen {
        background-color: green;
      }
      #keyYellow {
        background-color: yellow;
      }
      #logo {
        min-width: 40px;
        min-height: 40px;
        max-height: 60px;
        max-width: 60px;
      }
      #showObj {
        background-color: white;
        font-size: 1.5rem;
        width: 300px;
        height: 300px;
        color: red;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        /* border: 2px black solid; */
      }
      #startBtn {
        background-color: lime;
        min-width: 120px;
        width: 150px;
        height: 80%;
        font-size: 1.5rem;
        margin: 5px;
      }
      #testName {
        padding: 2px;
        width: 70%;
        font-size: 1.5rem;
      }
      #time {
        font-size: 1.5rem;
        padding: 10px;
        position: absolute;
        top: 0;
        right: 0;
        width: 200px;
        height: 50px;
        max-width: 40%;
        background-color: white;
      }
      #keyBtnContainer {
        height: 25%;
        /* display: flex; */
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      #optionSelect {
        background-color: lightgrey;
        min-width: 120px;
        width: 150px;
        height: 80%;
        font-size: 1.5rem;
        margin: 5px;
        padding: 100x;
      }
      .hidden {
        display: none;
      }

      .keyBtn {
        width: 100%;
        height: 100%;
      }
      td {
        width: 100px;
        height: 50px;
      }
      .blink {
        animation: blink 0.5s;
      }
      @keyframes blink {
        0% {
          opacity: 0;
          transform: scale(0.5, 0.5);
        }
        100% {
          opacity: 1;
          transform: scale(1, 1);
        }
      }
      @media only screen and (max-width: 600px) {
        html {
          font-size: 10px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div id="logo"><img src="./LogoColorTextBelow.jpeg" alt="logo" /></div>
      <div id="testName">DMRC/LMRC/NMRC Machine Test</div>
      <div id="testTypeTool" class="dropdown-container">
        <select id="optionSelect">
          <option value="1">Test Type 1</option>
          <option value="2">Test Type 2</option>
        </select>
      </div>
      <button id="startBtn">Start</button>
    </header>
    <main>
      <div id="info">
        <div id="instruction">
          <ul id="testType1" class="testType hidden">
            <li>Press B for next Picture</li>
            <li>Press 2 for Answering Red</li>
            <li>Press 4 for Answering Yellow</li>
            <li>Press 8 for Answering Green</li>
            <li>Press 0 for Answering Blue</li>
          </ul>
          <ul id="testType2" class="testType hidden">
            <li>Press B for next Picture</li>
            <li>Press R for Answering Red</li>
            <li>Press Y for Answering Yellow</li>
            <li>Press G for Answering Green</li>
          </ul>
        </div>
        <div id="time">Time remaining : <span style="color: red">60</span></div>
      </div>

      <div id="container">
        <div id="showObj">Click the Start Button to start the Test</div>
      </div>
      <div id="keyBtnContainer">
        <table>
          <tr>
            <td><button id="keyRed" class="keyBtn">2</button></td>
            <td><button id="keyYellow" class="keyBtn">4</button></td>
          </tr>
          <tr>
            <td><button id="keyGreen" class="keyBtn">8</button></td>
            <td rowspan="2"><button id="keyNext" class="keyBtn">B</button></td>
          </tr>
          <tr>
            <td><button id="keyBlue" class="keyBtn">0</button></td>
          </tr>
        </table>
      </div>
    </main>
    <footer>&copy Unlimited Education</footer>
    <script>
      var started = false;
      var testType = 1;
      var correct = 0;
      var inCorrect = 0;
      var newQuestion = true;
      var whichImage = 0;
      // Set up the image files to be used.
      var theImages = new Array(); // do not change this
      // To add more image files, continue with the
      // pattern below, adding to the array.
      var KEY_CODE = {};
      var len = 0;
      var correctColor = [];

      screenWidth = screen.width;
      console.log("screen width " + screenWidth);

      showDashboard = () => {
        // alert("correct : " + correct + "\n" + "Incorrect : " + inCorrect);
        myStorage = window.localStorage;
        localStorage.setItem("correct", correct);
        localStorage.setItem("inCorrect", inCorrect);
        location.href = "./result.html";
      };
      removeTestType = () => {
        document.getElementById("testTypeTool").style.display = "none";
      };

      startFunc = () => {
        started = true;
        if (screenWidth <= 600)
          document.getElementById("keyBtnContainer").style.display = "flex";
        var initial = new Date();
        var initialSec = initial.getSeconds();
        const timeElement = document.getElementById("time").childNodes[1];
        var timer = setInterval(() => {
          var curr = new Date();
          var currSec = curr.getSeconds();
          var diff = currSec - initialSec;
          diff = diff > 0 ? diff : 60 + diff;
          var timeRemaining = 60 - diff;
          timeElement.innerText = timeRemaining;
          // document.getElementById(

          // ).innerHTML = `Time remaining : <span color="red">${timeRemaining}`;
          if (timeRemaining <= 0) {
            started = false;
            clearInterval(timer);
            timeElement.innerText = 60;
            showDashboard();
          }
        }, 1000);
        newQuestion = true;
        whichImage = Math.round(Math.random() * (len - 1));
        imageInsertHandler(whichImage);
        stopFunc = () => {
          clearInterval(timer);
          started = false;
          timeElement.innerText = 60;
          showDashboard();
          // document.getElementById("startBtn").onclick = startFunc;
          document.getElementById("startBtn").innerText = "Start";
          document.getElementById("startBtn").style.backgroundColor = "lime";
          document.getElementById("keyBtnContainer").style.display = "none";
        };
        document.getElementById("startBtn").onclick = stopFunc;
        document.getElementById("startBtn").innerText = "Stop";
        document.getElementById("startBtn").style.backgroundColor = "red";
      };

      document.getElementById("startBtn").onclick = function () {
        removeTestType();
        var startingIn = 3;
        const getSet = setInterval(() => {
          document.getElementById(
            "showObj"
          ).innerText = `Starting in : ${startingIn}`;
          startingIn--;
          if (startingIn < 0) {
            startFunc();
            clearInterval(getSet);
          }
        }, 1000);
      };

      const play = (ch) => {
        if (started === false) return;
        // const ch = String.fromCharCode(event.charCode || event.keyCode);
        console.log(ch);
        ch = ch.toLowerCase();
        if (ch === KEY_CODE.next) {
          if (newQuestion === false) {
            newQuestion = true;
            whichImage = Math.round(Math.random() * (len - 1));
            imageInsertHandler(whichImage);
          }
        } else {
          if (newQuestion === true) {
            newQuestion = false;
            if (ch === correctColor[whichImage]) {
              console.log("correct");
              correct++;
            } else {
              inCorrect++;
              console.log("Incorrect");
            }
          }
        }
      };

      function showImage(whichImage) {
        document.getElementById("showObj").innerHTML =
          '<div class = "blink"><img src="../LightPictures/' +
          theImages[whichImage] +
          '" alt = "image"></div>';
      }
      const imageInsertHandler = (whichImage) => {
        // do not edit anything below this line
        // var j = 0;
        // var p = theImages.length;
        // var preBuffer = new Array();
        // for (i = 0; i < p; i++) {
        //   preBuffer[i] = new Image();
        //   preBuffer[i].src = theImages[i];
        // }
        showImage(whichImage);
      };

      document.addEventListener("DOMContentLoaded", function () {
        const optionSelect = document.getElementById("optionSelect");
        const testType1 = document.getElementById("testType1");
        const testType2 = document.getElementById("testType2");
        const testType = localStorage.getItem("testType");
        if (testType) {
          optionSelect.value = testType;
        }

        function updateDisplay() {
          if (optionSelect.value == "1") {
            testType1.classList.remove("hidden");
            testType2.classList.add("hidden");
            localStorage.setItem("testType", 1);
            handleTestType(1);
          } else {
            testType1.classList.add("hidden");
            testType2.classList.remove("hidden");
            localStorage.setItem("testType", 2);
            handleTestType(2);
          }
          localStorage.setItem("testType", optionSelect.value);
        }

        // Initial display update
        updateDisplay();

        // Event listener for dropdown change
        optionSelect.addEventListener("change", updateDisplay);
      });
      handleTestType = (type) => {
        handleKeyCode(type);
        handleImageAndAnswer(type);
        handleButtonPress(type);
        handleSmallScreenButtonGroup(type);
      };
      handleKeyCode = (type) => {
        if (type == 1) {
          KEY_CODE = {
            blue: "0",
            green: "8",
            yellow: "4",
            red: "2",
            next: "b",
          };
        } else {
          KEY_CODE = {
            blue: "b",
            green: "g",
            yellow: "y",
            red: "r",
            next: "b",
          };
        }
      };
      handleImageAndAnswer = (type) => {
        if (type == 1) {
          theImages = [];
          theImages[0] = "1.jpg";
          theImages[1] = "2.jpg";
          theImages[2] = "3.jpg";
          theImages[3] = "4.jpg";
          theImages[4] = "5.png";
          theImages[5] = "6.jpg";
          theImages[6] = "7.png";
          theImages[7] = "8.jpg";
          theImages[8] = "9.jpg";
          theImages[9] = "10.jpg";
          theImages[10] = "11.jpg";
          theImages[11] = "12.jpg";
          theImages[12] = "13.jpg";
          theImages[13] = "14.jpg";
          theImages[14] = "15.jpg";
          theImages[15] = "16.png";
          theImages[16] = "17.jfif";
          theImages[17] = "18.jfif";
          theImages[18] = "19.jfif";
          theImages[19] = "20.png";

          len = theImages.length;

          correctColor = [
            KEY_CODE.green,
            KEY_CODE.red,
            KEY_CODE.yellow,
            KEY_CODE.red,
            KEY_CODE.green,
            KEY_CODE.green,
            KEY_CODE.red,
            KEY_CODE.yellow,
            KEY_CODE.red,
            KEY_CODE.green,
            KEY_CODE.yellow,
            KEY_CODE.red,
            KEY_CODE.yellow,
            KEY_CODE.green,
            KEY_CODE.yellow,
            KEY_CODE.blue,
            KEY_CODE.blue,
            KEY_CODE.blue,
            KEY_CODE.blue,
            KEY_CODE.blue,
          ];
        } else {
          theImages = [];
          theImages[0] = "1.jpg";
          theImages[1] = "2.jpg";
          theImages[2] = "3.jpg";
          theImages[3] = "4.jpg";
          theImages[4] = "5.png";
          theImages[5] = "6.jpg";
          theImages[6] = "7.png";
          theImages[7] = "8.jpg";
          theImages[8] = "9.jpg";
          theImages[9] = "10.jpg";
          theImages[10] = "11.jpg";
          theImages[11] = "12.jpg";
          theImages[12] = "13.jpg";
          theImages[13] = "14.jpg";
          theImages[14] = "15.jpg";

          len = theImages.length;

          correctColor = [
            KEY_CODE.green,
            KEY_CODE.red,
            KEY_CODE.yellow,
            KEY_CODE.red,
            KEY_CODE.green,
            KEY_CODE.green,
            KEY_CODE.red,
            KEY_CODE.yellow,
            KEY_CODE.red,
            KEY_CODE.green,
            KEY_CODE.yellow,
            KEY_CODE.red,
            KEY_CODE.yellow,
            KEY_CODE.green,
            KEY_CODE.yellow,
          ];
        }
      };
      handleButtonPress = (type) => {
        document.addEventListener("keypress", function (event) {
          const ch = String.fromCharCode(event.charCode || event.keyCode);
          play(ch);
        });

        document
          .getElementById("keyRed")
          .addEventListener("click", function () {
            play(KEY_CODE.red);
          });
        document
          .getElementById("keyGreen")
          .addEventListener("click", function () {
            play(KEY_CODE.green);
          });
        document
          .getElementById("keyNext")
          .addEventListener("click", function () {
            play(KEY_CODE.next);
          });
        document
          .getElementById("keyYellow")
          .addEventListener("click", function () {
            play(KEY_CODE.yellow);
          });
        document
          .getElementById("keyBlue")
          .addEventListener("click", function () {
            play(KEY_CODE.blue);
          });
      };
      handleSmallScreenButtonGroup = (type) => {
        document.getElementById("keyRed").innerHTML = KEY_CODE.red;
        document.getElementById("keyGreen").innerHTML = KEY_CODE.green;
        document.getElementById("keyNext").innerHTML = KEY_CODE.next;
        document.getElementById("keyYellow").innerHTML = KEY_CODE.yellow;
        if (type == 2) {
          document.getElementById("keyBlue").style.display = "none";
        }
      };
    </script>
  </body>
</html>
